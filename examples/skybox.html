<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Hilo3d sphere Geometry Demo</title>
    <link rel="stylesheet" type="text/css" href="./example.css">
</head>
<body>
<div id="container"></div>
<script src="../build/Hilo3d.js"></script>
<script src="./js/stats.js"></script>
<script src="./js/OrbitControls.js"></script>
<script src="./js/init.js"></script>
<script>
    orbitControls.isLockZ = true;

    var loadQueue = new Hilo3d.LoadQueue([{
        type: 'CubeTexture',
        images: [
            '//gw.alicdn.com/tfs/TB1Ss.ORpXXXXcNXVXXXXXXXXXX-2048-2048.jpg_960x960.jpg',
            '//gw.alicdn.com/tfs/TB1YhUDRpXXXXcyaXXXXXXXXXXX-2048-2048.jpg_960x960.jpg',
            '//gw.alicdn.com/tfs/TB1Y1MORpXXXXcpXVXXXXXXXXXX-2048-2048.jpg_960x960.jpg',
            '//gw.alicdn.com/tfs/TB1ZgAqRpXXXXa0aFXXXXXXXXXX-2048-2048.jpg_960x960.jpg',
            '//gw.alicdn.com/tfs/TB1IVZNRpXXXXaNXFXXXXXXXXXX-2048-2048.jpg_960x960.jpg',
            '//gw.alicdn.com/tfs/TB1M3gyRpXXXXb9apXXXXXXXXXX-2048-2048.jpg_960x960.jpg'
        ]
    }, {
        src: '//ossgw.alicdn.com/tmall-c3/tmx/0356679fd543809bba95dfaea32e1d45.gltf'
    }]).on('complete', function () {
        var result = loadQueue.getAllContent();
        var skyboxMap = result[0];

        var geometry = new Hilo3d.BoxGeometry();

        var box = new Hilo3d.Mesh({
            geometry: geometry,
            material: new Hilo3d.BasicMaterial({
                lightType: 'NONE',
                side: Hilo3d.constants.BACK,
                diffuse: skyboxMap
            })
        }).addTo(stage);
        box.setScale(20);


        var material = new Hilo3d.BasicMaterial({
            diffuse: new Hilo3d.Color(0, 0, 0),
            skyboxMap: skyboxMap,
            refractRatio: 1/1.5,
            refractivity: 0.8,
            reflectivity: 0.2
        });

        var model = result[1];
        window.xx = model;
        model.node.setScale(0.001);
        model.meshes.forEach(function (m) {
            m.material = material;
            material.jointCount = model.materials[0].jointCount;
        });
        stage.addChild(model.node);
        model.node.onUpdate = function () {
            material.skyboxMatrix = new Hilo3d.Matrix4().invert(stage.worldMatrix);
        }

        // var mesh = new Hilo3d.Mesh({
        //     geometry: geometry,
        //     material: material,
        //     onUpdate: function () {
        //         material.skyboxMatrix = new Hilo3d.Matrix4().invert(stage.worldMatrix);
        //     }
        // }).addTo(stage);
    }).start();
</script>
</body>
</html>